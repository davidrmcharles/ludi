<!DOCTYPE HTML>
<html>
  <head>
    <title>ludi - First Declension Endings</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    </style>
    <script>

function allowDrop(e) {
    e.preventDefault();
}

function drag(e) {
    e.dataTransfer.setData("text", e.target.id);
    clearDropTargetIncorrectness(e.target.parentNode);
}

function drop(e) {
    e.preventDefault();

    var target = e.target;
    if (e.target.localName != "td") {
        target = target.parentNode;
    }

    if (target.hasChildNodes()) {
        var pile = document.getElementById("the-pile");
        pile.appendChild(target.firstChild);
    }

    var data = e.dataTransfer.getData("text");
    target.appendChild(document.getElementById(data));
    clearDropTargetIncorrectness(target);
}

function checkAnswers() {
    var correctness = [];
    var dropTargets = document.getElementsByClassName("drop-target");
    for (var i = 0; i < dropTargets.length; i++) {
        correctness.push(checkAnswer(dropTargets[i]));
    }

    if (correctness.every(function(e) { return !!e; })) {
        var button = document.getElementById("check-answers-button");
        var youWin = document.getElementById("you-win");
        button.style.display = "none";
        youWin.style.display = "inline";

    }
}

function checkAnswer(dropTarget) {
    if (dropTarget.firstChild == null) {
        setDropTargetIncorrectness(dropTarget);
        return false;
    }

    var answers = {
        "nominative-singular": "ending-a",
        "genitive-singular": "ending-ae",
        "dative-singular": "ending-ae",
        "accusative-singular": "ending-am",
        "ablative-singular": "ending-a",
        "nominative-plural": "ending-ae",
        "genitive-plural": "ending-arum",
        "dative-plural": "ending-is",
        "accusative-plural": "ending-as",
        "ablative-plural": "ending-is",
    };

    var answer = answers[dropTarget.id];
    var draggableId = dropTarget.firstChild.id.split(".")[0];
    if (draggableId == answer) {
        return true;
    } else {
        setDropTargetIncorrectness(dropTarget);
        return false;
    }
}

function setDropTargetIncorrectness(dropTarget) {
    dropTarget.style.backgroundColor = "salmon";
}

function clearDropTargetIncorrectness(dropTarget) {
    dropTarget.style.backgroundColor = "white";
}

function shufflePile() {
    var pile = document.getElementById("the-pile");
    for (var i = pile.children.length; i > 0; i--) {
        pile.appendChild(pile.children[Math.random() * i | 0]);
    }
}

window.onload = shufflePile

    </script>
  </head>
  <body>
    <table>
      <tr>
        <th colspan="3">First Declension Endings</th>
        <th colspan="2">The Pile</th>
      </tr>
      <tr>
        <th/>
        <th>Singular</th>
        <th>Plural</th>
      </tr>
      <tr class="drop-target-row">
        <td class="case-row-heading">Nom.</td>
        <td id="nominative-singular" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="nominative-plural" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="the-pile" class="the-pile" rowspan="5" colspan="2">
        <img src="ending-a.png" class="draggable" id="ending-a.0" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-ae.png" class="draggable" id="ending-ae.0" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-ae.png" class="draggable" id="ending-ae.1" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-am.png" class="draggable" id="ending-am" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-a.png" class="draggable" id="ending-a.1" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-ae.png" class="draggable" id="ending-ae.2" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-arum.png" class="draggable" id="ending-arum" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-is.png" class="draggable" id="ending-is.0" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-as.png" class="draggable" id="ending-as" draggable="true" ondragstart="drag(event)"/>
        <img src="ending-is.png" class="draggable" id="ending-is.1" draggable="true" ondragstart="drag(event)"/>
        </td>
      </tr>
      <tr class="drop-target-row">
        <td class="case-row-heading">Gen.</td>
        <td id="genitive-singular" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="genitive-plural" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
      </tr>
      <tr class="drop-target-row">
        <td class="case-row-heading">Dat.</td>
        <td id="dative-singular" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="dative-plural" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
      </tr>
      <tr class="drop-target-row">
        <td class="case-row-heading">Acc.</td>
        <td id="accusative-singular" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="accusative-plural" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
      </tr>
      <tr class="drop-target-row">
        <td class="case-row-heading">Abl.</td>
        <td id="ablative-singular" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
        <td id="ablative-plural" class="drop-target" ondragover="allowDrop(event)" ondrop="drop(event)"></td>
      </tr>
      <tr>
        <td colspan="4" style="text-align: center;">
        <button id="check-answers-button" type="button" style="width: 100%;" onclick="checkAnswers()">Check My Answers</button>
        <h1 id="you-win" style="display: none;">You Win!</h1>
        </td>
      </tr>
    </table>
  </body>
</html>
